!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueTms=e()}(this,function(){"use strict";var t=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t};return function(){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t(this,o),this.onList=[],this.subs=[],this.options={isDebugLog:!1},"boolean"==typeof e.isDebugLog&&(this.options.isDebugLog=e.isDebugLog),!o._Vue||!o._Tms)throw new Error("Please install with Vue.use(VueTms, Tms).");this.app=null}return e(o,[{key:"run",value:function(){var t=this;if(Object.defineProperty(this,"app",{enumerable:!1}),Object.defineProperty(this,"subs",{enumerable:!1}),Object.defineProperty(this,"onList",{enumerable:!1}),!o._Vue)return this;this.app=new o._Vue({data:this});return function e(r,i){Object.keys(r).forEach(function(s){var u=r[s];if(o._Tms&&u instanceof o._Tms){var a=function(e){var o,r=""+i.concat([s,e.type]).join(".");t.options.isDebugLog&&console&&console.log("position   "+r+"(payload: "+(o=e.payload,Object.prototype.toString.call(o).replace(/^(.*?) |]$/g,"").toLowerCase())+");","\n\rpayload   ",JSON.parse(JSON.stringify(e.payload)),"\n\rpayloads  ",JSON.parse(JSON.stringify(e.payloads)),"\n\rtarget    ",e.target,"\n\r---"),t.subs.forEach(function(t){return t(n({},e,{position:r,time:Date.now()}))})};u.dep.addSub(a),t.onList.push({target:u,onChage:a}),e(u,[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(i),[s]))}})}(this,[]),this}},{key:"subscribe",value:function(t){return this.subs.push(t),this}},{key:"unsubscribe",value:function(t){var e=this.subs.indexOf(t);return this.subs.splice(e,1),this}},{key:"destroy",value:function(){return this.app&&(this.app.$destroy(),this.onList.forEach(function(t){t.target.dep.removeSub(t.onChage)})),this.onList.splice(0,this.onList.length),this.subs.splice(0,this.subs.length),this}}],[{key:"install",value:function(t,e){o._Vue=t,o._Tms=e,Object.defineProperty(o._Vue.prototype,"$store",{get:function(){return this.$root._store}}),Object.defineProperty(o._Vue.prototype,"_store",{get:function(){return this.$options.store}}),o._Vue.mixin({destroyed:function(){this.$options.store&&this.$options.store.destroy()}})}}]),o}()});
