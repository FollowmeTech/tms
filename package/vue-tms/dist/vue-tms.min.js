!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.VueTms=e()}(this,function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}(),n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t};return function(){function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e(this,r),this.onList=[],this.subs=[],this.options={isDebugLog:!1},"boolean"==typeof t.isDebugLog&&(this.options.isDebugLog=t.isDebugLog),!r._Vue||!r._Tms)throw new Error("Please install with Vue.use(VueTms, Tms).");this.app=null}return o(r,[{key:"run",value:function(){var e=this;if(Object.defineProperty(this,"app",{enumerable:!1}),Object.defineProperty(this,"subs",{enumerable:!1}),Object.defineProperty(this,"onList",{enumerable:!1}),!r._Vue)return this;this.app=new r._Vue({data:this});return function o(i,s){Object.keys(i).forEach(function(u){var a=i[u];if(r._Tms&&a instanceof r._Tms){var p=function(o){var r,i=""+s.concat([u,o.type]).join(".");e.options.isDebugLog&&console&&console.log("position   "+i+"(payload: "+(r=o.payload,Object.prototype.toString.call(r).replace(/^(.*?) |]$/g,"").toLowerCase())+");","\n\rpayload   ","object"===t(o.payload)?JSON.parse(JSON.stringify(o.payload)):o.payload,"\n\rpayloads  ",JSON.parse(JSON.stringify(o.payloads)),"\n\rtarget    ",o.target,"\n\r---"),e.subs.forEach(function(t){return t(n({},o,{position:i,time:Date.now()}))})};a.dep.addSub(p),e.onList.push({target:a,onChage:p}),o(a,[].concat(function(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}(s),[u]))}})}(this,[]),this}},{key:"subscribe",value:function(t){return this.subs.push(t),this}},{key:"unsubscribe",value:function(t){var e=this.subs.indexOf(t);return this.subs.splice(e,1),this}},{key:"destroy",value:function(){return this.app&&(this.app.$destroy(),this.onList.forEach(function(t){t.target.dep.removeSub(t.onChage)})),this.onList.splice(0,this.onList.length),this.subs.splice(0,this.subs.length),this}}],[{key:"install",value:function(t,e){r._Vue=t,r._Tms=e,Object.defineProperty(r._Vue.prototype,"$store",{get:function(){return this.$root._store}}),Object.defineProperty(r._Vue.prototype,"_store",{get:function(){return this.$options.store}}),r._Vue.mixin({destroyed:function(){this.$options.store&&this.$options.store.destroy()}})}}]),r}()});
